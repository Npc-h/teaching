<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>增加食品</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
</head>
<body>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <form class="layui-form" method="post">



                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span>*</span>
                        食品名称
                    </label>
                    <div class="layui-input-block lafite_width_30">
                        <input type="text" name="foodName" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input" id="foodName">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span>*</span>
                        食品图片url
                    </label>
                    <div class="layui-input-block lafite_width_30">
                        <input type="foodUrl" name="foodUrl" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input" disabled="disabled" id="foodUrl">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span>*</span>
                        食品图片
                    </label>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn lafite_btn" id="lafite_upload">点击上传</button>
                        <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px; margin-left: 5%">
                            预览图：
                            <div class="layui-upload-list" id="demo2"></div>
                        </blockquote>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">
                        <span>*</span>
                        食品功能描述
                    </label>
                    <div class="layui-input-block lafite_width_60">
                        <textarea name="foodResult" placeholder="请输入内容" class="layui-textarea lafite_textarea" id="foodResult"></textarea>
                    </div>
                </div>


                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="lafite-layui-btn" lay-submit lay-filter="editFood">提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
<script>layui.use(['laydate', 'form', 'upload'],
    function() {

        var $ = layui.jquery
            ,upload = layui.upload;

        var form = layui.form;

        //提交编辑
        form.on('submit(editFood)', function (data) {

            $.ajax({
                url: 'http://localhost:8080/addFood',
                method: 'post',
                data: data.field,
                dataType: 'JSON',
                success: function (res) {
                    if(JSON.stringify(res) === "1"){
                        layer.msg('增加成功', {icon: 1,time: 1000},function () {
                            parent.location.reload();
                        });
                    }else {
                        layer.msg('增加失败', {icon: 2});
                    }
                },
                error: function (data) {
                    layer.msg("网络错误");
                }
            });
            return false;
        });







        //多图片上传
        upload.render({
            elem: '#lafite_upload'
            ,url: '/savePhoto'
            ,multiple: true
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                });
            }
            ,done: function(res){
                document.getElementById("foodUrl").value=res.data.src;
                console.log(res.data.src);
                layer.msg('图片上传保存成功', {icon: 1});
            }
            ,error: function(){
                console.log("失败");
            }
        });

    });


</script>

</html>